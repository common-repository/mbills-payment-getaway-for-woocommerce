
function isNumber(e) {
    e = e || window.event;
    var t = e.which ? e.which : e.keyCode;
    return !(8 != t && 0 != t && t > 31 && (t < 48 || t > 57))
}
jQuery(document).ready(function(e) {
    if ("undefined" == typeof mbillswc_params) return !1;
    1 == mbillswc_params.prevent_reload && (window.onbeforeunload = function() {
        return "Are you sure you want to leave?"
    });
    var t = e("#data-qr-code"),
        a = encodeURI(t.data("link"));

    e("#mbillswc-qrcode").length && new QRCode("mbillswc-qrcode", {
        text: a,
        width: t.data("width"),
        height: t.data("height"),
        correctLevel: QRCode.CorrectLevel.H,
        quietZone: 6,
        onRenderingEnd: function() {
            e("#mbillswc-confirm-payment").trigger("click"), e("#mbills-copy-link").click(function(t) {
               
                var a = e("<input>");
                e("body").append(a), a.val(mbillswc_params.upi_id).select(), document.execCommand("copy"), a.remove(), t.preventDefault()
            })
        }
    }), 

    e("#mbillswc-cancel-payment").click(function(e) {
        window.onbeforeunload = null, window.location = mbillswc_params.cancel_url, e.preventDefault()
    }), e(".mbillswc-return-link").click(function(e) {
        window.onbeforeunload = null, window.location = mbillswc_params.payment_url, e.preventDefault()
    }), e("#mbillswc-confirm-payment").on("click", function(a) {
        a.preventDefault();
        var intervalId = window.setInterval(function(){

        var data = {
        			'transaction_id_m': mbillswc_params.transaction_id_m
        		};
        jQuery.post(mbillswc_params.callback_check_payment_status, data, function(response) {
            console.log('r: ' + response);

        if (response == 3){

          window.onbeforeunload = null, e("#payment-success-container").html("<form method='POST' action='" + mbillswc_params.callback_url + "' id='MBJSCheckoutForm' style='display: none;'><input type='hidden' name='wc_order_id' value='" + mbillswc_params.orderid + "'><input type='hidden' name='wc_order_key' value='" + mbillswc_params.order_key + "'><input type='hidden' name='wc_mbills_tx_id' value='" + mbillswc_params.transaction_id_m + "'><input type='hidden' name='wc_transaction_id' value='" + null + "'></form>"), e.dialog({
                                                title: '<span class="mbillswc-popup-title-' + mbillswc_params.app_theme + '">Preverjanje mBills plačila...  <span>',
                                                content: "",
                                                useBootstrap: !1,
                                                draggable: !1,
                                                theme: mbillswc_params.app_theme,
                                                type: "white",
                                                closeIcon: !1,
                                                bgOpacity: 0.70,
                                                offsetBottom: e("#data-dialog-box").data("offset"),
                                                offsetTop: e("#data-dialog-box").data("offset"),
                                                boxWidth: e("#data-dialog-box").data("redirect")
                                            }), e("#MBJSCheckoutForm").submit();
    }
    else if (response == -1){

          window.onbeforeunload = null, e("#payment-success-container").html("<form method='POST' action='" + mbillswc_params.callback_url + "' id='MBJSCheckoutForm' style='display: none;'><input type='hidden' name='wc_order_id' value='" + mbillswc_params.orderid + "'><input type='hidden' name='wc_order_key' value='" + mbillswc_params.order_key + "'><input type='hidden' name='wc_mbills_tx_id' value='" + mbillswc_params.transaction_id_m + "'><input type='hidden' name='wc_transaction_id' value='" + null + "'></form>"), e.dialog({
                                                title: '<span class="mbillswc-popup-title-' + mbillswc_params.app_theme + '">Preverjanje mBills plačila...  <span>',
                                                content: "",
                                                useBootstrap: !1,
                                                draggable: !1,
                                                theme: mbillswc_params.app_theme,
                                                type: "white",
                                                closeIcon: !1,
                                                bgOpacity: 0.70,
                                                offsetBottom: e("#data-dialog-box").data("offset"),
                                                offsetTop: e("#data-dialog-box").data("offset"),
                                                boxWidth: e("#data-dialog-box").data("redirect")
                                            }), e("#MBJSCheckoutForm").submit();
    }




});

            }, mbillswc_params.is_mobile ? 4000 : 3000);
        var i = e.confirm({
            title: '<span class="mbillswc-popup-title-' + mbillswc_params.app_theme + '">  <p style="text-align:LEFT;">' + mbillswc_params.payment_text + '</p></span>',
           content: mbillswc_params.is_mobile ? '</br></br></br><div><a href="' + mbillswc_params.mbills_deeplink_pre + '' + mbillswc_params.mbills_code + '' + mbillswc_params.mbills_deeplink_aft + '"  style="background-color:#00a0db; border:1px solid #00a0db; border-radius:30px; color:#ffffff; display:inline-block; text-decoration: none; font-size:20px; font-weight: 400; line-height:60px;text-align:center; text-decoration:none; width:200px;-webkit-text-size-adjust:none;" >PLAČAJ Z MBILLS</a></div></br></br></br>' : '<center><img src="' + mbillswc_params.mbills_qr_service  + '' + mbillswc_params.mbills_code + '"></center>' ,
            useBootstrap: mbillswc_params.is_mobile ? 1 : !1,
            theme: mbillswc_params.app_theme,
            animation: "scale",
            type: "white",
            boxWidth: e("#data-dialog-box").data("pay"),
            draggable: !1,
            bgOpacity: 0.70,
            offsetBottom: e("#data-dialog-box").data("offset"),
            offsetTop: e("#data-dialog-box").data("offset"),
            autoClose: "nextStep|60000",
            buttons: {
                nextStep: {
                    text: "Prekliči",
                    btnClass: "btn-default",//+ e("#mbillswc-confirm-payment").data("theme"),
                    keys: ["enter", "shift"],
                
                        action: function() {
                                        var t = this.$content.find("#mbillswc-transaction-number").val();
                                        window.onbeforeunload = null, e("#payment-success-container").html("<form method='POST' action='" + mbillswc_params.callback_url + "' id='MBJSCheckoutForm' style='display: none;'><input type='hidden' name='wc_order_id' value='" + mbillswc_params.orderid + "'><input type='hidden' name='wc_order_key' value='" + mbillswc_params.order_key + "'><input type='hidden' name='wc_mbills_tx_id' value='" + mbillswc_params.transaction_id_m + "'><input type='hidden' name='wc_transaction_id' value='" + t + "'></form>"), e.dialog({
                                            title: '<span class="mbillswc-popup-title-' + mbillswc_params.app_theme + '">Preverjanje mBills plačila...  <span>',
                                            content: "",
                                            useBootstrap: !1,
                                            draggable: !1,
                                            theme: mbillswc_params.app_theme,
                                            type: "white",
                                            closeIcon: !1,
                                            bgOpacity: 0.70,
                                            offsetBottom: e("#data-dialog-box").data("offset"),
                                            offsetTop: e("#data-dialog-box").data("offset"),
                                            boxWidth: e("#data-dialog-box").data("redirect")
                                        }), e("#MBJSCheckoutForm").submit()
                                    }
                }
            }
        });
    })
});